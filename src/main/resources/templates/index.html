<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css"
          href="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.5/datatables.min.css"/>
    <script type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.5/datatables.min.js"></script>
</head>
<script>
    let table;
    let searchType;

    $(document).ready(function () {
        searchType = $('#searchType option:selected').val();
        console.log("searchType 찍힘 : "+searchType);
        table = $('#myTable').DataTable({
            serverSide: true, //데이터 서버사이드 처리 활성화.
            processing: true, //서버측 처리를 위해 테이블이 처리중 일때 '처리 중' 표시기의 표시를 활성화 또는 비활성화 한다.
            pageLength: 10, //한 페이지에 표시할 행의 개수
            ordering: true, // 컬럼별 정렬기능
            responsive: true,
            language: {
                emptyTable: "데이터가 없습니다.",
                lengthMenu: "페이지당 _MENU_ 개씩 보기",
                info: "현재 _START_ - _END_ / _TOTAL_건",
                infoEmpty: "데이터 없음",
                infoFiltered: "( _MAX_건의 데이터에서 필터링됨 )",
                search: "",
                zeroRecords: "일치하는 데이터가 없습니다.",
                loadingRecords: "로딩중...",
                processing: "잠시만 기다려 주세요.",
                paginate: {
                    next: "다음",
                    previous: "이전",
                },
            },
            ajax: {
                url: '/search',
                type: 'POST',
                contentType: 'application/json',
                dataType: 'json',
                data: function(d){
                    Object.assign(d,{"data": {"searchType": searchType}});
                    console.log(d);
                    return JSON.stringify(d);
                },
            },
            columns: [
                {data: "id", title: "id", searchable: false},
                {data: "name", title: "name"},
                {data: "age", title: "age"},
                {data: "hobby", title: "hobby"},
            ],
        });

        $("#myTable_filter").attr("hidden", "hidden");

        $("#searchType").change(function(){
            searchType = $(this).val();
        });

        $("#searchBtn").click(function () {
            const numCols = table.columns().nodes().length;
            for(let i=0; i<numCols; i++) {
                table.column(i).search('');
            }
            const searchValue = $("#searchValue").val();
            table.column(searchType).search(searchValue).draw();
        })
    });

</script>
<body>
    <select name="searchType" id="searchType">
        <option value="1" selected>name</option>
        <option value="2">age</option>
        <option value="3">hobby</option>
    </select>
    <input id="searchValue">
    <button type="button" id="searchBtn">Search</button>
    <table id="myTable"></table>
</body>
</html>